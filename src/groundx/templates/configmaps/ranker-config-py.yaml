{{- $ic := include "groundx.ranker.api.create" . -}}
{{- $ec := include "groundx.ranker.inference.create" . -}}

{{- if or (eq $ic "true") (eq $ec "true") }}
{{- $svc := include "groundx.ranker.serviceName" . -}}

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ $svc }}-config-py-map
  namespace: {{ include "groundx.ns" . }}
  labels:
{{ include "groundx.renderDefaultLabels" (dict "name" "" "indent" 4 "root" $) }}
data:
  config.py: |
    env = dict(
        deviceType={{ include "groundx.ranker.inference.deviceType" . | quote }},
        metricsAddr={{ include "groundx.metrics.cache.addr" . | quote }},
        metricsPort={{ include "groundx.metrics.cache.port" . }},
        searchBroker={{ printf "%s://%s:%v/0" (include "groundx.cache.scheme" .) (include "groundx.cache.addr" .) (include "groundx.cache.port" .) | quote }},
        searchLog={{ include "groundx.ranker.serviceName" . | quote }},
        searchResultBroker={{ printf "%s://%s:%v/0" (include "groundx.cache.scheme" .) (include "groundx.cache.addr" .) (include "groundx.cache.port" .) | quote }},
        service={{ include "groundx.ranker.serviceName" . | quote }},
        validAPIKeys=[{{ include "groundx.admin.apiKey" . | quote }}, {{ include "groundx.admin.username" . | quote }}],
        workers={{ include "groundx.ranker.inference.workers" . }},
    )
{{- end }}
