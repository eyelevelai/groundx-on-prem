minio-operator.yaml:
  1: |
    apiVersion: v1
    data:
      opensearch.yml: |
        cluster.name: opensearch-cluster

        # Bind to all interfaces because we don't know what IP address Docker will assign to us.
        network.host: 0.0.0.0

        # Setting network.host to a non-loopback address enables the annoying bootstrap checks. "Single-node" mode disables them again.
        # Implicitly done if ".singleNode" is set to "true".
        # discovery.type: single-node

        # Start OpenSearch Security Demo Configuration
        # WARNING: revise all the lines below before you go into production
        plugins:
          security:
            ssl:
              transport:
                pemcert_filepath: esnode.pem
                pemkey_filepath: esnode-key.pem
                pemtrustedcas_filepath: root-ca.pem
                enforce_hostname_verification: false
              http:
                enabled: true
                pemcert_filepath: esnode.pem
                pemkey_filepath: esnode-key.pem
                pemtrustedcas_filepath: root-ca.pem
            allow_unsafe_democertificates: true
            allow_default_init_securityindex: true
            authcz:
              admin_dn:
                - CN=kirk,OU=client,O=client,L=test,C=de
            audit.type: internal_opensearch
            enable_snapshot_restore_privilege: true
            check_snapshot_restore_write_privileges: true
            restapi:
              roles_enabled: ["all_access", "security_rest_api_access"]
            system_indices:
              enabled: true
              indices:
                [
                  ".opendistro-alerting-config",
                  ".opendistro-alerting-alert*",
                  ".opendistro-anomaly-results*",
                  ".opendistro-anomaly-detector*",
                  ".opendistro-anomaly-checkpoints",
                  ".opendistro-anomaly-detection-state",
                  ".opendistro-reports-*",
                  ".opendistro-notifications-*",
                  ".opendistro-notebooks",
                  ".opendistro-asynchronous-search-response*",
                ]
        ######## End OpenSearch Security Demo Configuration ########
    kind: ConfigMap
    metadata:
      labels:
        app.kubernetes.io/component: opensearch-cluster-master
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: operator
        app.kubernetes.io/version: 2.16.0
        helm.sh/chart: operator-2.23.1
      name: opensearch-cluster-master-config
  2: |
    apiVersion: policy/v1beta1
    kind: PodDisruptionBudget
    metadata:
      labels:
        app.kubernetes.io/component: opensearch-cluster-master
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: operator
        app.kubernetes.io/version: 2.16.0
        helm.sh/chart: operator-2.23.1
      name: opensearch-cluster-master-pdb
    spec:
      maxUnavailable: 1
      selector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: operator
  3: |
    apiVersion: v1
    kind: Service
    metadata:
      annotations: {}
      labels:
        app.kubernetes.io/component: opensearch-cluster-master
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: operator
        app.kubernetes.io/version: 2.16.0
        helm.sh/chart: operator-2.23.1
      name: opensearch-cluster-master
    spec:
      ports:
        - name: http
          port: 9200
          protocol: TCP
        - name: transport
          port: 9300
          protocol: TCP
      selector:
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/name: operator
      type: ClusterIP
  4: |
    apiVersion: v1
    kind: Service
    metadata:
      annotations:
        service.alpha.kubernetes.io/tolerate-unready-endpoints: "true"
      labels:
        app.kubernetes.io/component: opensearch-cluster-master
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: operator
        app.kubernetes.io/version: 2.16.0
        helm.sh/chart: operator-2.23.1
      name: opensearch-cluster-master-headless
    spec:
      clusterIP: None
      ports:
        - name: http
          port: 9200
        - name: transport
          port: 9300
        - name: metrics
          port: 9600
      publishNotReadyAddresses: true
      selector:
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/name: operator
  5: |
    apiVersion: apps/v1
    kind: StatefulSet
    metadata:
      annotations:
        majorVersion: 2.16.0
      labels:
        app.kubernetes.io/component: opensearch-cluster-master
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: operator
        app.kubernetes.io/version: 2.16.0
        helm.sh/chart: operator-2.23.1
      name: opensearch-cluster-master
    spec:
      podManagementPolicy: Parallel
      replicas: 1
      selector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: operator
      serviceName: opensearch-cluster-master-headless
      template:
        metadata:
          annotations:
            configchecksum: 4ef1e0d189d650dfb54a148e4ce4936122d3453eda7eb70c7984e478aa43d37
          labels:
            app.kubernetes.io/component: opensearch-cluster-master
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/managed-by: Helm
            app.kubernetes.io/name: operator
            app.kubernetes.io/version: 2.16.0
            helm.sh/chart: operator-2.23.1
          name: opensearch-cluster-master
        spec:
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
                - podAffinityTerm:
                    labelSelector:
                      matchExpressions:
                        - key: app.kubernetes.io/instance
                          operator: In
                          values:
                            - RELEASE-NAME
                        - key: app.kubernetes.io/name
                          operator: In
                          values:
                            - operator
                    topologyKey: kubernetes.io/hostname
                  weight: 1
          automountServiceAccountToken: false
          containers:
            - env:
                - name: node.name
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.name
                - name: discovery.seed_hosts
                  value: opensearch-cluster-master-headless
                - name: cluster.name
                  value: opensearch-cluster
                - name: network.host
                  value: 0.0.0.0
                - name: OPENSEARCH_JAVA_OPTS
                  value: -Xmx512M -Xms512M
                - name: node.roles
                  value: master,ingest,data,remote_cluster_client,
                - name: discovery.type
                  value: single-node
                - name: OPENSEARCH_INITIAL_ADMIN_PASSWORD
                  value: R0otb_*t!kazs
              image: public.ecr.aws/c9r4x6y5/eyelevel/opensearch:latest
              imagePullPolicy: IfNotPresent
              name: operator
              ports:
                - containerPort: 9200
                  name: http
                - containerPort: 9300
                  name: transport
                - containerPort: 9600
                  name: metrics
              readinessProbe:
                failureThreshold: 3
                periodSeconds: 5
                tcpSocket:
                  port: 9200
                timeoutSeconds: 3
              resources:
                requests:
                  cpu: 200m
                  memory: 512Mi
              securityContext:
                capabilities:
                  drop:
                    - ALL
                runAsNonRoot: true
                runAsUser: 1000
              startupProbe:
                failureThreshold: 30
                initialDelaySeconds: 5
                periodSeconds: 10
                tcpSocket:
                  port: 9200
                timeoutSeconds: 3
              volumeMounts:
                - mountPath: /usr/share/opensearch/data
                  name: opensearch-cluster-master
                - mountPath: /usr/share/opensearch/config/opensearch.yml
                  name: config-emptydir
                  subPath: opensearch.yml
          enableServiceLinks: true
          initContainers:
            - command:
                - sh
                - -c
                - |
                  #!/usr/bin/env bash
                  cp -r /tmp/configfolder/*  /tmp/config/
              image: public.ecr.aws/c9r4x6y5/eyelevel/opensearch:latest
              imagePullPolicy: IfNotPresent
              name: configfile
              resources: {}
              volumeMounts:
                - mountPath: /tmp/config/
                  name: config-emptydir
                - mountPath: /tmp/configfolder/opensearch.yml
                  name: config
                  subPath: opensearch.yml
          nodeSelector:
            node: eyelevel-cpu-only
          securityContext:
            fsGroup: 1000
            runAsNonRoot: true
            runAsUser: 1000
          terminationGracePeriodSeconds: 120
          volumes:
            - configMap:
                name: opensearch-cluster-master-config
              name: config
            - emptyDir: {}
              name: config-emptydir
      updateStrategy:
        type: RollingUpdate
      volumeClaimTemplates:
        - metadata:
            name: opensearch-cluster-master
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 20Gi
